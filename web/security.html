<div id="system">
    <div class="page page-center" id="waiting-security" style="display:none;">
        <div class="container container-slim py-4">
        <div class="text-center">
            <br /><br /><br />
            <div class="text-secondary mb-3" id="message-security"></div>
            <div class="progress progress-sm">
            <div class="progress-bar progress-bar-indeterminate"></div>
            </div>
        </div>
        </div>
    </div>
    <div class="datagrid" id="dg-security">
        <div class="datagrid-item">
            <div class="datagrid-title">SSL Certificates</div>
            <div class="datagrid-content">
                <a href="#showMasterCert" id="showMasterCert" class="btn btn-secondary w-100" aria-label="Show Master Certificate">Show Master Certificate</a>
                <div id="cert-instructions">
                    <span>
                        <a href="https://devstia.com/preview/install-master-cert" id="browser-install" class="ms-1" aria-label="How to install master certificate">Browser install instructions
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M9 15l6 -6"></path><path d="M11 6l.463 -.536a5 5 0 0 1 7.071 7.072l-.534 .464"></path><path d="M13 18l-.397 .534a5.068 5.068 0 0 1 -7.127 0a4.972 4.972 0 0 1 0 -7.071l.524 -.463"></path></svg>
                        </a>      
                    </span>
                </div>
                <p> </p>
                <a href="#regenCerts" id="regenCerts" class="btn btn-secondary w-100" aria-label="Regenerate All Certificates">Regenerate All Certificates</a>
            </div>
        </div>
        <div class="datagrid-item">
            <div class="datagrid-title">Devstia Password</div>
            <div class="datagrid-content">
                <div class="row g-2">
                    <div class="col">
                        <input id="pw-pass" type="password" class="form-control" />
                    </div>
                    <div class="col-auto">
                        <button id="view-pass" class="btn btn-icon" aria-label="view password">
                            <svg id="show-pw" xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-eye-off"
                                width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                                stroke-linecap="round" stroke-linejoin="round">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                <path d="M10.585 10.587a2 2 0 0 0 2.829 2.828"></path>
                                <path
                                    d="M16.681 16.673a8.717 8.717 0 0 1 -4.681 1.327c-3.6 0 -6.6 -2 -9 -6c1.272 -2.12 2.712 -3.678 4.32 -4.674m2.86 -1.146a9.055 9.055 0 0 1 1.82 -.18c3.6 0 6.6 2 9 6c-.666 1.11 -1.379 2.067 -2.138 2.87">
                                </path>
                                <path d="M3 3l18 18"></path>
                            </svg>
                            <svg id="hide-pw" xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-eye" width="24"
                                height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                                stroke-linecap="round" stroke-linejoin="round" style="display:none;">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0"></path>
                                <path d="M21 12c-2.4 4 -5.4 6 -9 6c-3.6 0 -6.6 -2 -9 -6c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6"></path>
                            </svg>
                        </button>
                    </div>
                    <div>
                        <a style="float:right;" href="#" id="savePass" class="btn btn-pill btn-primary btn-sm">Save</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="datagrid-item">
            <div class="datagrid-title">Terminal / SSH Keys</div>
            <div class="datagrid-content">
                <a href="#showSSHKeys" id="showSSHKeys" class="btn btn-secondary w-100" aria-label="Show SSH Keys">Show SSH Keys</a>
                <p> </p>
                <a href="#regenKeys" id="regenKeys" class="btn btn-secondary w-100">Regenerate SSH Keys</a>
            </div>
        </div>
        <div class="datagrid-item">
            <div class="datagrid-title">LAN IP</div>
            <div class="datagrid-content">
                <div class="row g-2">
                    <div class="col">
                        <input id="lan-ip" class="form-control" />
                    </div>
                    <div class="col-auto">
                        <button id="get-lanip" class="btn btn-icon" aria-label="get LAN IP">
                            <svg fill="#000000" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 
                                width="20" height="20" viewBox="0 0 96.666 96.666">
                            <g>
                                <g>
                                    <rect x="36" y="6" width="24.666" height="24.666"/>
                                    <rect y="66" width="24.666" height="24.666"/>
                                    <rect x="72" y="66" width="24.666" height="24.666"/>
                                    <polygon points="15.311,51.333 82.105,51.333 82.105,63.066 86.561,63.066 86.561,46.4 84.334,46.4 84.334,46.333 50.833,46.333 
                                        50.833,35 45.833,35 45.833,46.333 12.334,46.333 12.334,46.4 10.855,46.4 10.855,63.066 15.311,63.066 		"/>
                                </g>
                            </g>
                            </svg>
                        </button>
                    </div>
                    <div>
                        <a style="float:right;" href="#" id="saveLANIP" class="btn btn-pill btn-primary btn-sm">Save</a>
                        <label class="form-check form-switch">
                            <input id="dnsProxy" class="form-check-input" type="checkbox">
                            <span class="form-check-label">DNS Proxy</span>
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        // Show/hide waiting screen
        function showWaitingSecurity(message) {
            $('#message-security').html(message);
            $('#waiting-security').fadeIn();
            $('#dg-security').fadeOut();
        }
        function hideWaitingSecurity() {
            $('#waiting-security').fadeOut();
            $('#dg-security').fadeIn();
        }

        // Handle SSL Certificates
        $('#showMasterCert').click( (r) => {
            ipcComm.send('showMasterCert');
        });
        $('#regenCerts').click( (r) => {
            showWaitingSecurity('Regenerating master and all website certificates...');
            ipcComm.send('regenCerts', function() {
                hideWaitingSecurity();
            });
        });

        // Handle Terminal / SSH 
        $('#showSSHKeys').click( (r) => {
            ipcComm.send('showSSHKeys');
        });
        $('#regenKeys').click( (r) => {
            showWaitingSecurity('Regenerating SSH keys...');
            ipcComm.send('regenKeys', function() {
                hideWaitingSecurity();
            });
        });

        // Handle save password
        $('#savePass').click( (r) => {
            let pwPass = $('#pw-pass').val();
            if (window.lastPass == pwPass) return;
            showWaitingSecurity('Updating passwords...');
            window.lastPass = pwPass;
            ipcComm.send('savePass', { 'pwPass': pwPass }, function() {
                $('#show-pw').show();
                $('#hide-pw').hide();
                $('#pw-pass').attr('type', 'password');
                setTimeout(function() {
                    hideWaitingSecurity();
                }, 1000);
            });
        });
        $('#saveLANIP').click( (r) => {
            let lanIP = $('#lan-ip').val();
            showWaitingSecurity('Updating LAN IP...');
            ipcComm.send('saveLANIP', { 'lanIP': lanIP }, function() {
                setTimeout(function() {
                    hideWaitingSecurity();
                }, 1000);
            });
        });
        $('#get-lanip').click( (r) => {
            showWaitingSecurity('Getting LAN IP...');
            ipcComm.send('getLANIP', function(lanIP) {
                $('#lan-ip').val(lanIP);
                setTimeout(function() {
                    hideWaitingSecurity();
                }, 1000);
            });
        });
        $('#dnsProxy').click( (r) => {
            let dnsProxy = $('#dnsProxy').is(':checked');
            if ( dnsProxy ) {
                showWaitingSecurity('Starting DNS Proxy...');
            } else {
                showWaitingSecurity('Stopping DNS Proxy...');
            }
            ipcComm.send('dnsProxy', { 'dnsProxy': dnsProxy }, function(state) {
                setTimeout(function() {
                    $('#dnsProxy').prop('checked', state);
                    hideWaitingSecurity();
                }, 1000);
            });
        });
        window.fillOutSettings = function(pwSettings) {
            window.lastPass = pwSettings.pwPass;
            $('#pw-pass').val(pwSettings.pwPass);
            $('#lan-ip').val(pwSettings.lanIP);
            $('#vmsMemory').val(pwSettings.vmsMemory);
            $('#vmsCPUs').val(pwSettings.vmsCPUs);
            if (pwSettings.showTips) {
                showTips();
            }
            ipcComm.send('dnsProxyState', function(state) {
                $('#dnsProxy').prop('checked', state);
            });
        }

        // Prevent prohibited characters from being entered into the password field
        $('#pw-pass').on('keypress', function (event) {
            let key = String.fromCharCode(!event.charCode ? event.which : event.charCode);
            let prohibitedChars = '\'"\\`'
            if (prohibitedChars.indexOf(key) !== -1) {
                event.preventDefault();
                return false;
            }
        });

        // Handle view password button
        $('#view-pass').click(r => {
            if ($('#show-pw').is(':visible')) {
                $('#show-pw').hide();
                $('#hide-pw').show();
                $('#pw-pass').attr('type', 'text');
            } else {
                $('#show-pw').show();
                $('#hide-pw').hide();
                $('#pw-pass').attr('type', 'password');
            }
        });
    </script>
    <script src="links.js"></script>