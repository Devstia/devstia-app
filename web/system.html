<div id="system">
    <div class="page page-center" id="waiting-system" style="display:none;">
        <div class="container container-slim py-4">
        <div class="text-center">
            <br /><br /><br />
            <div class="text-secondary mb-3" id="message-system"></div>
            <div class="progress progress-sm">
            <div class="progress-bar progress-bar-indeterminate"></div>
            </div>
        </div>
        </div>
    </div>
    <div class="datagrid" id="dg-system">

        
        <div class="datagrid-item">

            <div class="datagrid-title">Status</div>
            <div class="datagrid-content" id="status-parent" style="height:30.6%;">
                <div id="status-server">
                    <span class="badge badge-outline bg-green-lt" id="apache2">Apache2</span>
                    <span class="badge badge-outline bg-green-lt" id="cron">CRON</span>
                    <span class="badge badge-outline bg-green-lt" id="hestia">HestiaCP</span>
                    <span class="badge badge-outline bg-green-lt" id="mariadb">MariaDB</span>
                    <span class="badge badge-outline bg-green-lt" id="nginx">NGINX</span>
                    <span class="badge badge-outline bg-green-lt" id="php-fpm">PHP-FPM</span>
                    <span class="badge badge-outline bg-green-lt" id="postgresql">PostgreSQL</span>
                    <span class="badge badge-outline bg-green-lt" id="smbd">Samba</span>
                    <span class="badge badge-outline bg-green-lt" id="vsftpd">VSFTP</span>
                </div>
                <div id="status-waiting">
                    <div class="page page-center" id="waiting">
                        <div class="container container-slim py-4">
                        <div class="text-center">
                            <br /><br /><br />
                            <div class="text-secondary mb-3" id="message"></div>
                            <div class="progress progress-sm">
                            <div class="progress-bar progress-bar-indeterminate"></div>
                            </div>
                        </div>
                        </div>
                    </div>
                </div>
            </div>



            <div class="datagrid-title">Snapshots</div>
            <div class="datagrid-content row inline-btns">
                <a href="#createSnapshot" id="createSnapshot" class="btn btn-secondary w-100">Create Snapshot</a>
                <p> </p>
                <a href="#restoreSnapshot" id="restoreSnapshot" class="btn btn-secondary w-100">Restore Snapshot</a>
                <p> </p>
                <a href="#erase" id="erase" class="btn btn-outline-danger w-100">Erase &amp; Re-install Server</a>
            </div>
            
        </div>

        <div class="datagrid-item">
            <div class="datagrid-title">Actions</div>
            <div class="datagrid-content">
                <a href="#localhost" id="localhost" class="btn btn-secondary w-100">My Websites (localhost)</a>
                <p> </p>
                <a href="#terminal" id="terminal" class="btn btn-secondary w-100">Terminal</a>
                <p> </p>
                <a href="#files" id="files" class="btn btn-secondary w-100">Files</a>
                <p> </p>
                <a href="#restartServer" id="restartServer" class="btn btn-secondary w-100">Restart Server</a>
                <p> </p>
                <a href="#quit" id="quit" class="btn btn-secondary w-100">Quit & Stop Server</a>
                <p> </p>
            </div>
        </div>

        <!-- <div class="datagrid-item" style="margin-top:-129px;">
        </div> -->

    
    </div>
</div>
<script>
    // Make status initially unknown
    $('.badge').css('opacity', '20%');

    // Check status
    function checkStatus() {
        ipcMain.send('checkStatus', function(stats) {
            $('.badge').css('opacity', '100%');
            setStatus('apache2', stats.indexOf('[ + ]  apache2') > -1);
            setStatus('cron', stats.indexOf('[ + ]  cron') > -1);
            setStatus('hestia', stats.indexOf('[ + ]  hestia') > -1);
            setStatus('mariadb', stats.indexOf('[ + ]  mariadb') > -1);
            setStatus('nginx', stats.indexOf('[ + ]  nginx') > -1);
            setStatus('postgresql', stats.indexOf('[ + ]  postgresql') > -1);
            setStatus('smbd', stats.indexOf('[ + ]  smbd') > -1);
            setStatus('vsftpd', stats.indexOf('[ + ]  vsftpd') > -1);
            setStatus('php-fpm', (stats.indexOf('[ - ]  php') > -1) == false);
            $('#status-waiting').hide();
            console.log(stats);
        });
    }
    function setStatus(service, online) {
        if (online) {
            $('#' + service).removeClass('bg-red').addClass('bg-green-lt');
        } else {
            $('#' + service).removeClass('bg-green-lt').addClass('bg-red');
        }
    }
    var csInterval = setInterval(checkStatus, 10000);
    checkStatus();

    // Show/hide waiting screen
    function showWaitingSystem(message) {
        $('#message-system').html(message);
        $('#waiting-system').fadeIn();
        $('#dg-system').fadeOut();
    }
    function hideWaitingSystem() {
        $('#waiting-system').fadeOut();
        $('#dg-system').fadeIn();
    }

    // Handle Snapshots
    $('#createSnapshot').click( (r) => {
        ipcMain.send('createSnapshot');
    });
    $('#restoreSnapshot').click( (r) => {
        ipcMain.send('restoreSnapshot');
    });
    $('#erase').click( (r) => {
        ipcMain.send('erase');
    });

    // Handle Actions
    $('#localhost').click( (r) => {
        ipcMain.send('localhost');
    });
    $('#terminal').click( (r) => {
        ipcMain.send('terminal');
    });
    $('#files').click( (r) => {
        ipcMain.send('files');
    });
    $('#restartServer').click( (r) => {
        showWaitingSystem('Restarting server...');
        ipcMain.send('restartServer', function() {
            setTimeout(() => {
                $('.badge').css('opacity', '20%'); // Status unknown
                $('#status-waiting').show();
                hideWaitingSystem();
            }, 5000);
        });
    });
    $('#quit').click( (r) => {
        ipcMain.send('quit', true);
    });
</script>
<script src="links.js"></script>